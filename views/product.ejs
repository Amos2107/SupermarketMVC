<%- include('partials/header') %>
<%- include('partials/navbar') %>

<style>
  .product-hero {
    background: linear-gradient(135deg, #0d47a1, #0f6fde);
    color: #fff;
    border-radius: 16px;
    padding: 22px;
    box-shadow: 0 12px 28px rgba(13, 71, 161, 0.18);
  }
</style>

<div class="container py-4">
  <% if (product) { %>
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <div class="product-hero mb-3 d-flex justify-content-between align-items-center">
          <div>
            <p class="mb-1 text-uppercase small opacity-75">Product</p>
            <h3 class="fw-bold mb-0"><%= product.productName %></h3>
          </div>
          <span class="badge bg-light text-primary fs-6">$<%= product.price.toFixed(2) %></span>
        </div>

        <div class="card shadow-sm border-0">
          <div class="card-body p-4">
            <div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-3">
              <% const inStock = product.quantity > 0; %>
              <% const lowStock = inStock && product.quantity < 10; %>
              <span class="stock-pill <%= inStock ? 'bg-success text-white' : 'bg-secondary text-white' %>">
                <%= inStock ? (lowStock ? 'Low stock' : 'In stock') : 'Out of stock' %>
              </span>
              <span class="badge bg-light text-primary">$<%= product.price.toFixed(2) %></span>
            </div>
            <img
              src="/images/<%= product.image %>"
              alt="<%= product.productName %>"
              class="img-fluid rounded mb-3 shadow-sm"
              style="max-height: 280px; object-fit: contain;"
            >

            <div class="product-meta mb-3">
              <div class="bg-white border rounded-3 p-3">
                <div class="text-muted small">Available</div>
                <div class="fw-semibold"><%= product.quantity %></div>
              </div>
              <div class="bg-white border rounded-3 p-3">
                <div class="text-muted small">Price</div>
                <div class="fw-semibold">$<%= product.price.toFixed(2) %></div>
              </div>
              <div class="bg-white border rounded-3 p-3">
                <div class="text-muted small">Product ID</div>
                <div class="fw-semibold">#<%= product.id %></div>
              </div>
            </div>

            <% if (user.role !== 'admin') { %>
              <form action="/cart/add/<%= product.id %>" method="POST" class="d-flex flex-wrap gap-2 align-items-end justify-content-center mb-3">
                <div>
                  <label class="form-label small text-muted">Quantity</label>
                  <% const maxSelectable = Math.max(1, Math.min(10, product.quantity || 0)); %>
                  <select name="quantity" class="form-select" <%= inStock ? '' : 'disabled' %>>
                    <% for (let q = 1; q <= maxSelectable; q++) { %>
                      <option value="<%= q %>"><%= q %></option>
                    <% } %>
                  </select>
                </div>
                <button type="submit" class="btn btn-primary" <%= inStock ? '' : 'disabled' %>>
                  <%= inStock ? 'Add to Cart' : 'Out of Stock' %>
                </button>
              </form>
            <% } %>

            <div class="d-flex justify-content-center gap-2 mt-3">
              <% if (user.role === 'admin') { %>
                <a href="/inventory" class="btn btn-outline-secondary">Back to Inventory</a>
                <a href="/updateProduct/<%= product.id %>" class="btn btn-primary">Edit Product</a>
              <% } else { %>
                <a href="/shopping" class="btn btn-outline-secondary">Back to Shopping</a>
                <a href="/cart" class="btn btn-outline-primary">View Cart</a>
              <% } %>
            </div>
          </div>
        </div>
      </div>
    </div>
  <% } else { %>
    <p class="text-center mt-5">No product found.</p>
  <% } %>
</div>

<%- include('partials/footer') %>
