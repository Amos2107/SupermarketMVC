<%- include('partials/header') %>
<%- include('partials/navbar') %>

<style>
  .cart-hero {
    background: linear-gradient(135deg, #0d47a1, #0f6fde);
    border-radius: 16px;
    padding: 24px;
    color: #fff;
    box-shadow: 0 12px 28px rgba(13, 71, 161, 0.18);
  }
  .cart-table thead {
    background: rgba(13, 71, 161, 0.12);
  }
  .cart-summary {
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.08);
  }
</style>

<div class="container py-4">
  <div class="breadcrumb-bar mb-3">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb mb-0">
        <li class="breadcrumb-item"><a href="/">Home</a></li>
        <li class="breadcrumb-item active" aria-current="page">Cart</li>
      </ol>
    </nav>
  </div>
  <div class="cart-hero mb-4 d-flex flex-wrap justify-content-between align-items-center gap-2">
    <div>
      <p class="mb-1 text-uppercase small opacity-75">Your basket</p>
      <h3 class="fw-bold mb-0">Cart</h3>
    </div>
    <a href="/shopping" class="btn btn-light text-primary fw-semibold">Back to Shopping</a>
  </div>

  <% if (cart.length === 0) { %>
    <div class="text-center py-4 bg-white rounded-3 shadow-sm">
      <p class="mb-2">Your cart is empty.</p>
      <a href="/shopping" class="btn btn-primary">Start shopping</a>
    </div>
  <% } else { %>
    <div class="row g-4">
      <div class="col-lg-8">
        <div class="table-responsive cart-table">
          <table class="table table-sticky align-middle bg-white shadow-sm">
            <thead class="text-center">
              <tr>
                <th>Product</th>
                <th>Image</th>
                <th>Price</th>
                <th>Quantity</th>
                <th>Subtotal</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              <% let total = 0; %>
              <% cart.forEach(item => { %>
                <% total += item.priceAtTime * item.quantity; %>
                <tr class="text-center">
                  <td><%= item.productName %></td>
                  <td><img src="/images/<%= item.image %>" class="img-thumbnail" style="max-width: 70px;"></td>
                  <td>$<%= Number(item.priceAtTime).toFixed(2) %></td>
                  <td>
                    <form action="/cart/update/<%= item.cartItemId %>" method="POST" class="d-flex justify-content-center gap-2">
                      <select name="quantity" class="form-select w-auto">
                        <% for (let q = 1; q <= 10; q++) { %>
                          <option value="<%= q %>" <%= item.quantity === q ? "selected" : "" %>><%= q %></option>
                        <% } %>
                      </select>
                      <button class="btn btn-outline-primary btn-sm">Update</button>
                    </form>
                  </td>
                  <td>$<%= (item.priceAtTime * item.quantity).toFixed(2) %></td>
                  <td>
                    <form action="/cart/delete/<%= item.cartItemId %>" method="POST">
                      <button class="btn btn-outline-danger btn-sm">Delete</button>
                    </form>
                  </td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      </div>

      <div class="col-lg-4">
        <div class="cart-summary p-4">
          <h5 class="fw-semibold mb-3">Order Summary</h5>
          <div class="d-flex justify-content-between mb-2">
            <span>Items</span>
            <span><%= cart.length %></span>
          </div>
          <div class="d-flex justify-content-between mb-2">
            <span>Subtotal</span>
            <strong>$<%= total.toFixed(2) %></strong>
          </div>
          <hr>
          <div class="d-flex justify-content-between align-items-center mb-3">
            <span class="fw-semibold">Total</span>
            <h4 class="mb-0 text-primary">$<%= total.toFixed(2) %></h4>
          </div>
          <div class="d-grid gap-2">
            <form action="/checkout" method="POST" class="d-grid">
              <button type="submit" class="btn btn-primary">Checkout</button>
            </form>
            <form action="/cart/clear" method="GET" class="d-grid">
              <button type="submit" class="btn btn-outline-danger">Clear Cart</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  <% } %>
</div>

<%- include('partials/footer') %>
